!function(e){e.fn.asmSelect=function(t){var i={listType:"ol",sortable:!1,highlight:!1,animate:!1,addItemTarget:"bottom",hideWhenAdded:!1,debugMode:!1,removeLabel:"remove",highlightAddedLabel:"Added: ",highlightRemovedLabel:"Removed: ",containerClass:"asmContainer",selectClass:"asmSelect",optionDisabledClass:"asmOptionDisabled",listClass:"asmList",listSortableClass:"asmListSortable",listItemClass:"asmListItem",listItemLabelClass:"asmListItemLabel",removeClass:"asmListItemRemove",highlightClass:"asmHighlight"};return e.extend(i,t),this.each(function(t){function s(){var s=y.parents("."+i.containerClass).length>0;if(s&&void 0===y.data("asmselect.init"))a();else if(s)return;for(;e("#"+i.containerClass+t).size()>0;)t++;I=e("<select></select>").addClass(i.selectClass).attr("name","").attr("id",i.selectClass+t).addClass("not").css({width:y.outerWidth()}),$selectRemoved=e("<select></select>"),L=e("<"+i.listType+"></"+i.listType+">").addClass(i.listClass).attr("id",i.listClass+t),w=e("<div></div>").addClass(i.containerClass).attr("id",i.containerClass+t),d(),I.change(n).click(o),y.change(r).wrap(w).before(I).before(L),i.sortable&&l(),I.wrap('<span class="cloudfw-ui-select" style="float:none !important; display: inline-block;"></span>'),I.after('<span class="the-arrow-wrap"><span class="the-arrow"></span></span><span class="cloudfw-ui-select-title"></span>'),y.removeData("cloudfw-select"),e.browser.msie&&e.browser.version<8&&L.css("display","inline-block"),y.data("asmselect.init",!0),y.off("asmselect.destroy",a),y.on("asmselect.destroy",a)}function a(){var e=y.parents("."+i.containerClass).first();y.unbind("change",r),y.show(),y.parent().before(y),y.find("option").removeAttr("id"),e.remove()}function l(){L.sortable({items:"li."+i.listItemClass,handle:"."+i.listItemLabelClass,update:function(t,i){var s;e(this).children("li").each(function(t){return $option=e("#"+e(this).attr("rel")),e(this).is(".ui-sortable-helper")?void(s=$option.attr("id")):void y.append($option)}),s&&C(s,"sort")}}).addClass(i.listSortableClass)}function n(t){if(!(e.browser.msie&&e.browser.version<7)||A){var i=e(this).children("option:selected").slice(0,1).attr("rel");f(i),A=!1,C(i,"add")}}function o(){A=!0}function r(t){return x?void(x=!1):(I.empty(),L.empty(),d(),void(e.browser.opera&&L.hide().fadeIn("fast")))}function d(){$=!0,I.prepend("<option value=''>"+y.attr("title")+"</option>"),y.children("option").each(function(i){var s,a=e(this);a.attr("id")||a.attr("id","asm"+t+"option"+i),s=a.attr("id"),a.is(":selected")?(f(s),h(s,!0)):h(s)}),i.debugMode||y.hide(),c(),$=!1}function h(t,i){if(void 0==i)var i=!1;var s=e("#"+t),a=e("<option>"+s.html()+"</option>").val(s.val()).attr("rel",t);i&&p(a),I.append(a)}function c(){I.children(":eq(0)").attr("selected",!0)}function p(t){t.addClass(i.optionDisabledClass).attr("selected",!1).attr("disabled",!0),i.hideWhenAdded&&t.hide(),e.browser.msie&&I.hide().show()}function m(t){t.removeClass(i.optionDisabledClass).attr("disabled",!1),i.hideWhenAdded&&t.show(),e.browser.msie&&I.hide().show()}function f(t){if(void 0!==t){var s=e("#"+t);if(s){var a=s.html();if(""!=a){var l=e("<a></a>").attr("href","#").addClass(i.removeClass).prepend(i.removeLabel).click(function(){return u(e(this).parent("li").attr("rel")),!1}),n=e("<span></span>").addClass(i.listItemLabelClass).html(a),o=e("<li></li>").attr("rel",t).addClass(i.listItemClass).append(n).append(l).hide();if(!$){if(s.is(":selected"))return;s.attr("selected",!0)}"top"!=i.addItemTarget||$?(L.append(o),i.sortable&&y.append(s)):(L.prepend(o),i.sortable&&y.prepend(s)),v(o),p(e("[rel="+t+"]",I)),$||(g(o,i.highlightAddedLabel),c(),i.sortable&&L.sortable("refresh"))}}}}function v(e){i.animate&&!$?e.animate({opacity:"show",height:"show"},100,"swing",function(){e.animate({height:"+=2px"},50,"swing",function(){e.animate({height:"-=2px"},25,"swing")})}):e.show()}function u(t,s){if(void 0==s)var s=!0;var a=e("#"+t);a.attr("selected",!1),$item=L.children("li[rel="+t+"]"),b($item),m(e("[rel="+t+"]",i.removeWhenAdded?$selectRemoved:I)),s&&g($item,i.highlightRemovedLabel),C(t,"drop")}function b(e){i.animate&&!$?($prevItem=e.prev("li"),e.animate({opacity:"hide",height:"hide"},100,"linear",function(){$prevItem.animate({height:"-=2px"},50,"swing",function(){$prevItem.animate({height:"+=2px"},100,"swing")}),e.remove()})):e.remove()}function g(s,a){if(i.highlight){I.next("#"+i.highlightClass+t).remove();var l=e("<span></span>").hide().addClass(i.highlightClass).attr("id",i.highlightClass+t).html(a+s.children("."+i.listItemLabelClass).slice(0,1).text());I.after(l),l.fadeIn("fast",function(){setTimeout(function(){l.fadeOut("slow")},50)})}}function C(t,i){x=!0,$option=e("#"+t),y.trigger("change",[{option:$option,value:$option.val(),id:t,item:L.children("[rel="+t+"]"),type:i}])}var w,I,L,y=e(this),$=!1,A=!1,x=!1;s()})}}(jQuery);