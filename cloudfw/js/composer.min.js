!function(){"use strict";var e,t,a,o,r,n,s,i,l,c,d,p,u,m,f,_,v,y,h,g,w,j,Q,C,b,k,x=new Array("1/1","5/6","3/4","2/3","1/2","1/3","1/4","1/6"),T=new Array("span12","span10","span9","span8","span6","span4","span3","span2"),O=0,F=0,t={global_element_id:100,__construct:function(){e=this,j=jQuery("form#post").first(),a=jQuery("body"),o=jQuery("#cloudfw-composer",a),n=jQuery("#cloudfw_composer_metabox",a),s=jQuery(".cloudfw-composer-content-wrap",o),l=jQuery("#cloudfw-composer-activate",o),g=jQuery("#cloudfw-composer-new-post",o),d=jQuery(".cloudfw-composer-content",o),c=jQuery("#cloudfw-composer-header",o),w=jQuery("#cloudfw-composer-sources",o),_=".cloudfw-composer-content-wrap ul.droppable:not(.not), .cloudfw-composer-content",m=c.find(".dragable-element"),f=c.find("#cloudfw-composer-components"),y=jQuery("#cloudfw-composer-loading",a),v=jQuery("#cloudfw-composer-overlay",a),h=jQuery("#cloudfw-composer-save-button",a),p=d.first()},init:function(){if(this.__construct(),o.length){var t=' 					<p class="composer-switcher"> 						<a id="cloudfw-composer-switcher" class="button-primary" href="javascript:;">Switch to Content Composer</a> 					</p> 				';jQuery("#titlediv").after(t),i=jQuery("#cloudfw-composer-switcher"),l.is(":checked")?e.activate():e.deactivate(),i.bind("click",function(){e.toggle()});var a={action:"cloudfw_composer_ajax_load",post_id:jQuery("#cloudfw-composer-post-id",o).val(),nonce:CloudFwOp.cloudfw_nonce};jQuery.ajax({url:CloudFwOp.ajaxUrl,cache:!1,type:"POST",data:jQuery.param(a,!0),success:function(t){jQuery("#cloudfw-composer-content").html(t),jQuery("#cloudfw-composer-is-loaded").val("yes"),d.html(t),e.seek_contents(d),r=jQuery(":input",d).serialize()}})}},toggle:function(){l.is(":checked")?e.deactivate():e.activate()},activate:function(){l.prop("checked",!0),i.text(CloudFwOp.textCompSwitchtoClassic),jQuery("#postdivrich").hide(),n.show(),e.generate(),e.resize_callback(),jQuery.scrollTo(O,{duration:0})},deactivate:function(){l.prop("checked",!1),i.text(CloudFwOp.textCompSwitchtoComp),jQuery("#postdivrich").show(),n.hide(),e.resize_callback()},unloadPage:function(){return jQuery(":input",d).serialize()!=r?"Unsaved changes will be lost. Really continue?":void 0},generate:function(){if("1"==o.attr("data-generated"))return!0;o.attr("data-generated","1"),e.focusout(),v.disableSelection(),m.draggable({scroll:!0,zIndex:2700,opacity:1,cursor:"pointer",helper:"clone"}),e.seek_contents(d),d.droppable({accept:".dragable-element",activeClass:"ui-state-hover",hoverClass:"ui-state-active",greedy:!0,drop:function(t,a){var r=(jQuery(this),a.draggable),n=(a.helper,r.attr("data-type")),s=w.find("#composer-"+n);return d.hasClass("ajaxing")?!1:(s.length&&e.get_source(s,function(){e.reset_active_drop();var t=jQuery('<div id="temp-create-element" />').attr("data-type",s.attr("data-type"));return t.appendTo(p),e.get_options(s),e.check(t,function(){o.find("#temp-create-element").remove();var t=s.clone().appendTo(p);e.sync_elements(s,t),e.seek_contents(d)},function(){o.find("#temp-create-element").remove()}),!1}),e.refresh(),!1)}}),m.on("click",function(){var t=jQuery(this),a=t.attr("data-type");return t.hasClass("ui-draggable-dragging")?!0:(e.add_composer_element(a),!1)}),e.loading("hide"),e.reset_active_drop(),d.on("click",function(t){var a=jQuery(t.target).parents(".composer-item");a.length&&e.set_active_element(a.first()),jQuery(t.target).parents(".composer-2ndlevel").length||e.reset_active_drop()}),o.delegate(".cloudfw-composer-done","click",function(e){jQuery(this);return d.find(".composer-item.editing").find(".item-edit").first().click(),!1}),o.delegate("#cloudfw-composer-edit-next-button","click",e.edit_next),o.delegate("#cloudfw-composer-edit-prev-button","click",e.edit_prev),h.on("click",function(){e.__construct(),e.match_item_classes(d);var t=g.is(":checked");if(jQuery(":input",j).not(jQuery(":input",n)).serialize()!=Q&&(t=!0),t)if(jQuery("form#post #publish").length){window.onbeforeunload=null,jQuery(window).off("beforeunload");var a=jQuery("form#post").find(":submit, a.submitdelete, #post-preview");a.removeClass("disabled"),jQuery("form#post #publish").removeClass("disabled").click();h.__sending()}else e.save(o);else e.save(o);return!1}),o.delegate(".cloudfw-composer-add-item","click",function(t){var a=jQuery(this),o=a.attr("data-id");e.set_active_drop(a.parents("li").first()),e.add_composer_element(o),t.preventDefault()}),d.delegate(".composer-item-options input","keydown keyup",function(e){13==e.which&&e.preventDefault()}),e.shortcuts(),e.follow_page(),e.javascript_utilities(),e.footer_navigation();var t=setInterval(function(){r=jQuery(":input",d).serialize(),Q=jQuery(":input",j).not(jQuery(":input",n)).serialize(),window.onbeforeunload=e.unloadPage,clearInterval(t)},10);jQuery(document).delegate("#collapse-menu","click",e.resize_callback)},add_composer_element:function(t){var a=w.find("#composer-"+t);e.get_source(a,function(){var t=jQuery('<div id="temp-create-element" />').attr("data-type",a.attr("data-type"));p.children("li").filter(".active-element").length&&p.children("li").filter(".active-element").first().after(t),t.appendTo(p),e.get_options(a),e.check(t,function(){o.find("#temp-create-element").remove();var t=a.clone();p.children("li").filter(".active-element").length&&p.children("li").filter(".active-element").first().after(jQuery('<div class="temp-item-wrap"/>')),t.appendTo(p),e.sync_elements(a,t),e.seek_contents(p)},function(){o.find("#temp-create-element").remove()})})},loading:function(e){"hide"==e?(o.show().removeClass("hidden"),y.hide()):(o.hide(),y.show())},ajax_loading:function(e){if("hide"==e)v.hide(),d.find(".ajax-loader").remove();else{var t=' 					<li class="composer-item not ajax-loader span12 first last" data-ready="1" style="display: block; ">  						<div class="init">  							<div class="composer-item-controls">  								<div class="column-changer column-changer-passive">  									<span class="column-text"> 										<i class="composer-element-loading"></i> 									</span>  									<a href="javascript:;" class="column-decrease">&lt;</a>  									<a href="javascript:;" class="column-increase">&gt;</a>  								</div>  								<div class="item-title">  									<span class="title-text">Loading...</span>  								</div>  							</div>  						</div>  					</li>  				';v.show(),p.children("li").filter(".active-element").length?p.children("li").filter(".active-element").first().after(t):p.append(t)}},set_active_drop:function(t){if(d.hasClass("edit-mode"))return!0;if(e.reset_active_drop(),t.addClass("active-drop"),p=t.find(".row-fluid").first(),t.length){var a=t.find(".composer-element").first(),o=e.item_options(a);if(o.allow_only){"object"!=typeof o.allow_only&&(o.allow_only=[o.allow_only]);var r="."+o.allow_only.join(", .")}if(o.not_allow){"object"!=typeof o.not_allow&&(o.not_allow=[o.not_allow]);var n="."+o.not_allow.join(", .")}r&&(f.find("li").not(".active").addClass("deactive"),f.find(r).removeClass("deactive").addClass("active")),n&&(f.find("li").not(".deactive").addClass("active"),f.find(n).removeClass("active").addClass("deactive"))}},reset_active_drop:function(e){p=d,o.find(".active-drop").removeClass("active-drop"),f.find("li").removeClass("active").removeClass("deactive")},event_listener_active_drop:function(t){t.on("click",function(t){var a=jQuery(t.target).parents("li.composer-item").first();a.find("ul.row-fluid").length?e.set_active_drop(a):a.parent().click()})},set_active_element:function(e){d.find("li.active-element").removeClass("active-element"),u=e.addClass("active-element")},seek_contents:function(t){for(var a=t.children(".composer-element"),r=0;r<a.length;++r){var n=jQuery(a[r]),s=n.attr("data-ready");n.attr("data-type");s||e.insert_item(n,!1)}for(var i=t.children(".composer-item"),r=0;r<i.length;++r){var n=jQuery(i[r]),s=n.attr("data-ready");n.attr("data-type");s||e.insert_item(n,!1),n.find(".droppable").length&&(e.seek_contents(n),n.find(".droppable").droppable({accept:".dragable-element",activeClass:"ui-state-hover",hoverClass:"ui-state-active",greedy:!0,drop:function(t,a){var r=jQuery(this),n=a.draggable;if(e.set_active_drop(r.parents("li").first()),"1"==n.attr("data-ready"))n.detach().appendTo(r),e.seek_contents(r),e.match_item_classes(r);else{var s=n.attr("data-type"),i=w.find("#composer-"+s);e.get_source(i,function(){var t=jQuery('<div id="temp-create-element" />').attr("data-type",i.attr("data-type"));return t.appendTo(p),e.get_options(i),e.check(t,function(){o.find("#temp-create-element").remove();var t=i.clone().appendTo(r);e.sync_elements(i,t),e.seek_contents(r),e.match_item_classes(r)},function(){o.find("#temp-create-element").remove()}),!1})}return e.refresh(),!1},create:function(t,a){var o=jQuery(this);e.set_active_drop(o.parents("li").first()),e.seek_contents(o),e.match_item_classes(o),e.refresh()}}))}},serialize:function(e){var t=e.find("input, textarea, select"),a=t.serialize();return a},save:function(t){window.onbeforeunload=null,jQuery(window).off("beforeunload"),cloudfw_global_loading("show");var a={curtime:(new Date).getTime(),action:"cloudfw_save_composer",nonce:CloudFwOp.cloudfw_nonce,post_id:jQuery("#cloudfw-composer-post-id",o).val()},n=e.serialize(t),s=h.__sending();return jQuery.ajax({url:CloudFwOp.ajaxUrl,cache:!1,type:"POST",data:jQuery.param(a,!0)+"&"+n,error:function(e){jQuery("form#post #publish").length&&(window.onbeforeunload=null,jQuery(window).off("beforeunload"),jQuery("form#post #publish").click(),h.__sending())},success:function(e){try{jQuery(t).trigger("ajaxCallback",[t,e]);var a=jQuery.parseJSON(e);jQuery("form#post").hasClass("disabled")&&("1000"==a.messageId?s.success():"1025"==a.messageId?(s.success(),cloudfw_dialog(a.messageTitle,a.messageText,a.messageCase)):(s.error("Not Saved"),cloudfw_dialog(a.messageTitle,a.messageText,a.messageCase)),jQuery(window).trigger("CloudFW:composer:saved"))}catch(o){jQuery("form#post").hasClass("disabled")&&s.error(),jQuery("form#post #publish").length&&(window.onbeforeunload=null,jQuery(window).off("beforeunload"),jQuery("form#post #publish").click(),h.__sending())}cloudfw_global_loading("hide"),r=jQuery(":input",d).serialize(),cloudfw_destroy()}}),!1},refresh:function(){e.match_item_classes(p),jQuery(_,o).sortable({connectWith:jQuery(_,o),handle:".composer-item-controls",revert:!1,forcePlaceholderSize:!0,placeholder:"composer-placeholder",cursor:"move",delay:100,beforeStop:function(t,a){var r=a.item,n=jQuery(this);r.find(".composer-element").first().css("display",""),e.get_options(r.find(".composer-element").first()),e.check(r.attr("data-type",r.find(".composer-element").first().attr("data-type")),function(){r.removeAttr("data-type"),e.match_item_classes(r.parents("ul.row-fluid"))},function(){r.removeAttr("data-type"),n.sortable("cancel")}),o.find(".ui-state-active").removeClass("ui-state-active")},update:function(a,o){var r=!1,n=o.item,s=n.parents("ul.row-fluid"),i=s.length,l=n.attr("data-parent-parent-name"),c=n.parents(".composer-item").first().attr("data-parent-name");l!=c&&(r=!0),n.attr("data-parent-global-id",i),r&&(t.global_element_id++,n.attr("data-level",i),c?n.attr("data-parent-parent-name",c):n.removeAttr("data-parent-parent-name"),e.update_item_levels(n),e.match_item_classes())},start:function(e,t){var a=t.item;jQuery(this);a.find(".composer-element").first().css("display","none")},stop:function(t,a){var o=a.item,r=o.parents("ul.row-fluid");e.match_item_classes(r.first())}}),o.find(".ui-state-active").removeClass("ui-state-active")},refresh_column_classes:function(t){t||(t=p),e.match_item_classes(t)},insert_item:function(a,o){if(t.global_element_id++,o)var r=a.clone();else var r=a;r.removeClass("hidden"),e.wrap_element(r),e.refresh()},item_options:function(e){var t={};try{var a=e.attr("data-composer-options");a&&(t=jQuery.parseJSON(a)),e.hasClass("duplicating")&&(t.column=e.find("#_composer-column").first().val(),t.title=e.parent().find("#_composer-title").first().val(),e.removeClass("duplicating"))}catch(o){console.log("JSON Error"),console.log(e)}return t},get_options:function(t){C={},C=e.item_options(t)},get_error_message:function(e,t,a,o){try{var r=C.error_messages;if(r){if(r[a]){if(r[a].title&&"string"==typeof r[a].title)var e=r[a].title;if(r[a].message&&"string"==typeof r[a].message)var t=r[a].message}if(o&&r[a]){if(r[a][o]&&"string"==typeof r[a][o].title)var e=r[a][o].title;if(r[a][o]&&"string"==typeof r[a][o].message)var t=r[a][o].message}}cloudfw_dialog(e,t,"cancel")}catch(n){cloudfw_dialog("Javascript Error!","Javascript error has been occurred.","cancel")}},get_source:function(t,a){t.hasClass("ajax")?(e.ajax_loading("show"),d.addClass("ajaxing"),jQuery.ajax({url:CloudFwOp.ajaxUrl,cache:!1,data:{nonce:CloudFwOp.cloudfw_nonce,action:"cloudfw_call_composer_element",type:t.attr("data-type")},success:function(o){t.removeClass("ajax"),t.html(o),e.ajax_loading("hide"),d.removeClass("ajaxing"),"function"==typeof a&&a.call()}})):"function"==typeof a&&a.call()},check:function(t,a,o,r){if(d.hasClass("edit-mode"))return!0;var n=!1;"undefined"==typeof r&&(r=!0);var s=e.item_options(t.parents(".composer-element").first());if(!n&&C.not_in&&("object"!=typeof C.not_in&&(C.not_in=[C.not_in]),jQuery.each(C.not_in,function(a,o){return n?!0:void(t.parents("."+o).length&&(n=!0,r&&e.get_error_message("Hoops!","You cannot use this component inside the active area.","not_in",o)))})),!n&&C["in"]&&("object"!=typeof C["in"]&&(C["in"]=[C["in"]]),jQuery.each(C["in"],function(a,o){return n?!0:void(1!==t.parents("."+o).length&&(n=!0,r&&e.get_error_message("Hoops!","You have to use this component inside "+o,"in",o)))})),!n&&s.not_allow&&("object"!=typeof s.not_allow&&(s.not_allow=[s.not_allow]),jQuery.each(s.not_allow,function(a,o){return n?!0:void(t.attr("data-type")==o&&(n=!0,r&&e.get_error_message("Hoops!","Parent component doesn't allow this element.","not_allow",t.attr("data-type"))))})),!n&&s.allow_only){"object"!=typeof s.allow_only&&(s.allow_only=[s.allow_only]);var n=!0;jQuery.each(s.allow_only,function(e,a){return t.attr("data-type")==a?(n=!1,!0):void 0}),n&&r&&e.get_error_message("Hoops!","Parent component doesn't allow this element.","allow_only",t.attr("data-type"))}if(!n&&C.only_first_level&&(t.parent().hasClass("1stlevel")||(n=!0,r&&e.get_error_message("Hoops!","This component can only be added to first level.","only_first_level"))),!n&&s.limit){"number"!=typeof s.limit&&(s.limit=parseInt(s.limit));var i=t.parent().children("li").length+1;i>s.limit&&(n=!0,r&&e.get_error_message("Hoops!","Cannot add element more than item.","limit"))}n||0!=C.self_accept||t.parents("."+t.attr("data-type")).length&&(n=!0,r&&e.get_error_message("Hoops!","This component cannot be added inside the same type component."+t.attr("data-type"),"self_accept")),n?("function"!=typeof a&&(o=function(){alert("An error occurred.")}),o.call(t)):"function"==typeof a&&a.call(t)},make_name:function(e){var a=(e.find(".composer-element"),e.parents("ul.row-fluid")),o=parseInt(a.length);return e.find("select, input, textarea").not(".not").each(function(){var a=jQuery(this),r=a.attr("id"),n=a.attr("name");if("undefined"!=typeof r&&"undefined"!=typeof n){if("1"!=a.attr("data-changed")&&a.attr("data-name",n),1==o){var s=a.parents("ul.row-fluid").first().attr("data-variable");if(a.attr("data-name").indexOf("[]")>-1)var i=s+"["+t.global_element_id+"]["+r+"][]";else var i=s+"["+t.global_element_id+"]["+r+"]"}else if(o>1){var l=e.attr("data-parent-name");if(a.attr("data-name").indexOf("[]")>-1)var i=l+"["+r+"][]";else var i=l+"["+r+"]"}a.attr("name",i),a.attr("data-changed","1")}}),e},wrap_element:function(t){e.get_options(t);var a=p.find(".temp-item-wrap").first(),o=a.length,r=e.column_text_to_class(C.column);o?a.append(t):p.append(t),t.wrap('<li class="composer-item '+r+'" />'),t.wrap('<div class="init" />');var n=t.parent().parent(),s=n.children(".init");return s.prepend('<div class="highlighter">'),jQuery('<div class="composer-item-controls" />').prependTo(s),e.prepare_controls(n),e.update_item_levels(n),o&&(n.unwrap(),p.find(".temp-item-wrap").remove()),e.do_scripts(n),n.hide().fadeIn(1e3),e.set_active_element(n),e.event_listener_active_drop(n),n},update_item_levels:function(a){e.get_options(a.find(".composer-element").first());var o=parseInt(a.parents("ul.row-fluid").length);if(a.attr("data-level",o),a.attr("data-global-id",t.global_element_id),1==o){var r=a.parents("ul.row-fluid").first().attr("data-variable");a.attr("data-parent-name",r+"["+t.global_element_id+"]")}else o>1?(a.attr("data-parent-global-id",a.parents(".composer-item").first().attr("data-global-id")),a.attr("data-parent-parent-name",a.parents(".composer-item").first().attr("data-parent-name")),a.attr("data-parent-name",a.parents(".composer-item").first().attr("data-parent-name")+"[_composer_data]["+t.global_element_id+"]")):a.removeAttr("data-parent-global-id");a.attr("data-ready","1"),a.find("ul.row-fluid").length&&a.addClass("item-droppable"),e.make_name(a),a.find(".composer-item").each(function(){t.global_element_id++,e.update_item_levels(jQuery(this))})},prepare_controls:function(a){var r=a.find(".composer-item-controls").first();r.html("");var n=jQuery("<div />").addClass("column-changer"),i=' 						<span class="column-text"></span> 						<a href="javascript:;" class="column-decrease"><</a> 						<a href="javascript:;" class="column-increase">></a> ';n.html(i),n.find(".column-text").text(C.column),n.appendTo(r),a.find("#_composer-column").first().val(C.column),C.allow_columns?(n.addClass("column-changer-active"),n.find(".column-decrease").on("click",function(){var t=e.get_column_size(a);a.removeClass(t[0]).addClass(t[2]);var o=e.column_class_to_text(t[2]);n.find(".column-text").text(o),a.find("#_composer-column").first().val(o),e.refresh_column_classes(a.parents("ul.row-fluid").first()),cloudfw_destroy()}),n.find(".column-increase").on("click",function(){var t=e.get_column_size(a);a.removeClass(t[0]).addClass(t[1]);var o=e.column_class_to_text(t[1]);n.find(".column-text").text(o),a.find("#_composer-column").first().val(o),e.refresh_column_classes(a.parents("ul.row-fluid").first()),cloudfw_destroy()})):(n.addClass("column-changer-passive"),n.find(".column-text").text("1/1"));var l=' 					<span class="title-text"></span> 					<div class="title-input"> 						<input type="text" id="_composer-title" name="_composer-title" data-original-title="'+C.original_title+'" class="input input_250" value="" /> 					</div> 					<span class="title-original-text">('+C.original_title+")</span> 				",p=jQuery("<div />").addClass("item-title");p.html(l),p.children("span.title-text").text(C.title),p.appendTo(r);var u=p.find(".title-input > input");u.val(C.title),p.children("span.title-text").on("click",function(){var e=jQuery(this);e.hide().next(".title-input").show().children("input").select(),r.addClass("compact")}),u.on("blur focusout",function(){var e=jQuery(this);e.keyup().parent().hide().parent().find(".title-text").show(),""==u.val()&&u.val(u.attr("data-original-title")).keyup(),r.removeClass("compact")}),u.on("keydown keyup",function(t){var a=jQuery(this),o=a.val();o=""==o?a.attr("data-original-title"):o.replace(/<\/?[^>]+(>|$)/g,""),p.children("span.title-text").text(e.title(o)),(13==t.which||27==t.which)&&(jQuery(this).blur(),t.preventDefault())});var m=' 					<a class="item-duplicate cloudfw-tooltip" title="clone" href="javascript:;">Clone</a> 					<a class="item-remove cloudfw-tooltip" title="remove" href="javascript:;">Remove</a> 				',f=jQuery("<div />").addClass("controls-right");f.html(m),f.appendTo(r),0!=C.allow_edit&&(f.prepend('<a class="item-edit cloudfw-tooltip" title="options" href="javascript:;">options</a> '),r.find("a.item-edit").on("click",function(){var t=r.parent().parent(),a=t.find(".composer-element").first(),n=t.find(".composer-item-options").first();if(jQuery(this).parents(".composer-item").css({position:""}),n.is(":visible"))t.removeClass("editing"),d.addClass("normal-mode").removeClass("edit-mode"),jQuery(".cloudfw-composer-editing-buttons",c).hide(),e.focusout(),a.unbind("resize"),d.find("#cloudfw-composer-edit-overlay").remove(),d.css("height","").css("min-height",""),e.match_item_classes(t.parents(".ul.row-fluid").first()),e.match_item_classes(d),jQuery.scrollTo(O,{duration:0}),jQuery(_,o).filter(":ui-sortable").sortable("enable");else{if(O=jQuery(document).scrollTop(),d.removeClass("normal-mode").addClass("edit-mode"),t.addClass("editing").before('<div id="cloudfw-composer-edit-overlay"></div>'),e.reset_active_drop(),!n.find("#cloudfw-composer-done-button-wrap").length){var i='<div id="cloudfw-composer-done-button-wrap"> 								<div class="module clean"> 									<div> 										<div class="grid oneof4"></div> 										<div class="grid threeof4 last">											<a class="cloudfw-composer-done small-button small-sky" href="javascript:;"> 												<span>'+CloudFwOp.textCompDoneEditing+'</span> 											</a> 										</div><div class="clear"></div> 									</div> 								</div> 							</div>';n.append(i)}jQuery(".cloudfw-composer-editing-buttons",c).show(),a.resize(function(){var e=jQuery(this).outerHeight()+90;d.css("height",e).css("min-height","auto")}).resize(),jQuery.scrollTo(s,{duration:0,offset:{top:-40},onAfter:function(){}}),jQuery(_,o).filter(":ui-sortable").sortable("disable")}cloudfw_main(n)})),r.find("a.item-remove").on("click",function(){var t=jQuery(this);if(!t.hasClass("apply"))return CloudFw_UI.sure.init({resume:function(){t.addClass("apply").click()},cancel:function(e){t.removeClass("apply"),e.close()}}),event.preventDefault(),!1;var a=jQuery(this).parents(".composer-item").first(),o=a.prev(".composer-item");if(o.length)o.delay(10).queue(function(){e.set_active_element(o)});else{var r=a.next(".composer-item");r.length&&r.delay(10).queue(function(){e.set_active_element(r)})}var n=a.parents("ul.row-fluid").first();jQuery(a).removeData(),jQuery("*",a).removeData(),a.remove(),e.refresh_column_classes(n),e.refresh_column_classes(),cloudfw_main()}),r.find("a.item-duplicate").on("click",function(){var a=r.parent().parent(),n=a.parents("ul.row-fluid").first(),s=a.find(".composer-element").first();e.set_active_drop(n.parents("ul.row-fluid").first());var i=a,l=jQuery('<div id="temp-create-element" />').attr("data-type",i.find(".composer-element").first().attr("data-type"));a.after(l),e.get_options(i.find(".composer-element").first()),e.check(l,function(){var r=a.clone();s.addClass("duplicating"),t.global_element_id++,e.get_options(s),o.find("#temp-create-element").remove(),e.sync_elements(a,r),a.after(r),r=a.next(),e.prepare_controls(r),e.update_item_levels(r),e.event_listener_active_drop(r),e.match_item_classes(n),e.seek_contents(r.parent("ul.row-fluid").first());var i=r.find(".composer-item");i.length&&(i.each(function(){var a=jQuery(this),o=a.find(".composer-element").first();o.addClass("duplicating"),t.global_element_id++,e.get_options(o),e.prepare_controls(a),e.update_item_levels(a),e.event_listener_active_drop(a)}),e.seek_contents(r.parent("ul.row-fluid").first()),e.match_item_classes(i)),e.do_scripts(r),r.hide().fadeIn(400)},function(){o.find("#temp-create-element").remove()},!0)}),r.disableSelection()},match_columns:function(t,a){var o=t.attr("data-columns"),r=o.split("-");jQuery.each(r,function(o,r){e.insert_column(r,t,a)})},insert_column:function(e,t,a){jQuery("<div />")},column_text_to_class:function(e){var t=jQuery.inArray(e,x);return-1!=t?T[t]:"span12"},column_class_to_text:function(e){var t=jQuery.inArray(e,T);return-1!=t?x[t]:"1/1"},get_column_size:function(e){return e.hasClass("span12")?new Array("span12","span2","span10"):e.hasClass("span10")?new Array("span10","span12","span9"):e.hasClass("span9")?new Array("span9","span10","span8"):e.hasClass("span8")?new Array("span8","span9","span6"):e.hasClass("span6")?new Array("span6","span8","span4"):e.hasClass("span4")?new Array("span4","span6","span3"):e.hasClass("span3")?new Array("span3","span4","span2"):e.hasClass("span2")?new Array("span2","span3","span12"):void 0},match_item_classes:function(e){var t=0,a=0;jQuery(e).children(".composer-item").removeClass("first").removeClass("last").each(function(e){var o=jQuery(this);o.hasClass("span12")?a=12:o.hasClass("span10")?a=10:o.hasClass("span9")?a=9:o.hasClass("span8")?a=8:o.hasClass("span6")?a=6:o.hasClass("span4")?a=4:o.hasClass("span3")?a=3:o.hasClass("span2")&&(a=2),t+=a,t>10&&12>=t&&(o.addClass("last"),o.next(".composer-item").addClass("first"),t=0),t>12&&(o.addClass("first"),o.prev(".composer-item").addClass("last"),t=a)}),jQuery(e).children(".composer-item:first").addClass("first"),jQuery(e).children(".composer-item:last").addClass("last"),d.find(".composer-item").each(function(){var e=jQuery(this);e.hasClass("last")?e.find("#_composer-last").first().val("1"):e.find("#_composer-last").first().val("0")})},move_up:function(){if(d.hasClass("edit-mode"))return!0;if("object"==typeof u){var a,r=u.prev("li"),n=u.parents("ul.row-fluid"),s=n.length;u.attr("data-parent-parent-name");if(r.length)u.stop(1,1).fadeOut(200),r.before(u.detach().fadeIn(200)),u=d.find(".active-element").first();else if(s>1){var r=u.parents(".composer-item").first();if(r.length){var i=u,l=jQuery('<div id="temp-create-element" />').attr("data-type",i.find(".composer-element").first().attr("data-type"));r.before(l),e.get_options(i.find(".composer-element").first()),e.check(l,function(){t.global_element_id++,o.find("#temp-create-element").remove(),u.stop(1,1).fadeOut(200),r.before(i.detach().fadeIn(200)),u=d.find(".active-element").first(),a=i.parents(".composer-item").first().attr("data-parent-name"),i.attr("data-parent-global-id",s),i.attr("data-level",s),a?i.attr("data-parent-parent-name",a):i.removeAttr("data-parent-parent-name"),e.update_item_levels(u),e.match_item_classes(u.parents("ul.row-fluid"))},function(){o.find("#temp-create-element").remove()},!1)}}e.match_item_classes(n.first()),e.match_item_classes(d)}},done_editing:function(){"object"==typeof u&&u.length&&u.find(".composer-item-controls").first().find(".item-edit").click()},edit_next:function(){if(!d.hasClass("edit-mode"))return!0;if(e.set_active_element(jQuery(".composer-item",d).filter(".editing")),e.done_editing(),"object"==typeof u){var t=u.next("li"),a=u.parents("ul.row-fluid"),o=a.length;if(t.length)t.find(".composer-item-controls").first().find(".item-edit").click();else if(o>1){var t=u.parents(".composer-item").first();if(t.length)t.find(".composer-item-controls").first().find(".item-edit").click();else{var t=jQuery(".composer-item",d).first();t.length&&t.find(".composer-item-controls").first().find(".item-edit").click()}}else{var t=jQuery(".composer-item",d).first();t.length&&t.find(".composer-item-controls").first().find(".item-edit").click()}}},edit_prev:function(){if(!d.hasClass("edit-mode"))return!0;if(e.set_active_element(jQuery(".composer-item",d).filter(".editing")),e.done_editing(),"object"==typeof u){var t=u.prev("li"),a=u.parents("ul.row-fluid"),o=a.length;if(t.length)t.find(".composer-item-controls").first().find(".item-edit").click();else if(o>1){var t=u.parents(".composer-item").first();if(t.length)t.find(".composer-item-controls").first().find(".item-edit").click();else{var t=jQuery(".composer-item",d).last();t.length&&t.find(".composer-item-controls").first().find(".item-edit").click()}}else{var t=jQuery(".composer-item",d).last();t.length&&t.find(".composer-item-controls").first().find(".item-edit").click()}}},select_down:function(){if(d.hasClass("edit-mode"))return!0;if("object"==typeof u){var t=u.next("li"),a=u.parents("ul.row-fluid"),o=a.length;if(t.length)e.set_active_element(t),t.hasClass("item-droppable")&&e.set_active_drop(t);else if(o>1){var t=u.parents(".composer-item").first();t.length&&(e.set_active_element(t),t.hasClass("item-droppable")&&e.set_active_drop(t))}}},select_up:function(){if(d.hasClass("edit-mode"))return!0;if("object"==typeof u){var t=u.prev("li"),a=u.parents("ul.row-fluid"),o=a.length;if(t.length)e.set_active_element(t),t.hasClass("item-droppable")&&e.set_active_drop(t);else if(o>1){var t=u.parents(".composer-item").first();t.length&&(e.set_active_element(t),t.hasClass("item-droppable")&&e.set_active_drop(t))}}},move_down:function(){if(d.hasClass("edit-mode"))return!0;if("object"==typeof u){var a,r=u.next("li"),n=u.parents("ul.row-fluid"),s=n.length;u.attr("data-parent-parent-name");if(r.length)u.stop(1,1).fadeOut(200),r.after(u.detach().fadeIn(200)),u=d.find(".active-element").first();else if(s>1){var r=u.parents(".composer-item").first();if(r.length){var i=u,l=jQuery('<div id="temp-create-element" />').attr("data-type",i.find(".composer-element").first().attr("data-type"));r.before(l),e.get_options(i.find(".composer-element").first()),e.check(l,function(){t.global_element_id++,o.find("#temp-create-element").remove(),u.stop(1,1).fadeOut(200),r.after(i.detach().fadeIn(200)),u=d.find(".active-element").first(),a=i.parents(".composer-item").first().attr("data-parent-name"),i.attr("data-parent-global-id",s),i.attr("data-level",s),a?i.attr("data-parent-parent-name",a):i.removeAttr("data-parent-parent-name"),e.update_item_levels(u),e.match_item_classes(u.parents("ul.row-fluid"))},function(){o.find("#temp-create-element").remove()},!1)}}e.match_item_classes(n.first()),e.match_item_classes(d)}},follow_page:function(){b=jQuery(window),k=f.offset().top-28,F=0,e.resize_callback(),e.scroll_callback(),b.bind("resize",e.resize_callback),b.on("scroll",e.scroll_callback)},scroll_callback:function(){var e=b.scrollTop();e>=k&&!F?(F=1,f.addClass("fixed")):k>=e&&F&&(F=0,f.removeClass("fixed"))},resize_callback:function(){var e=s.width(),t=parseInt(f.css("padding-left"))+parseInt(f.css("padding-right")),a=e-t;f.width(a)},sync_elements:function(e,t){return cloudfw_sync_elements(e,t)},do_scripts:function(t){if(!t.length)return!0;var a=e.item_options(t.find(".composer-element").first()),o=t.find(".composer-element").first().attr("data-type"),r=t.find(".composer-item-options").first();cloudfw_composer_javascript_utilities(o,r),a.sync_title&&e.sync_titles(t,a);var n=t.find(".composer-item");n.length&&n.each(function(){e.do_scripts(jQuery(this))})},javascript_utilities:function(){d.find(".composer-item").each(function(){e.do_scripts(jQuery(this))})},sync_titles:function(e,t){var a=e.find("#_composer-title").first(),o=e.find(".composer-item-options").first(),r=o.find("#"+C.sync_title).first();if(r.length){var n=r[0].tagName;cloudfw_jqueried("cloudfw-composer-option-title",r)||("INPUT"==n?r.bind("focusout",function(){var e=jQuery(this).val();a.val(e).keyup()}).focusout():"TEXTAREA"==n?r.bind("focusout",function(){var e=jQuery(this).val();a.val(e).keyup()}).blur():"SELECT"==n&&r.bind("change",function(){var e=jQuery(this).find(":selected").first();if(""!=e.attr("value"))var t=e.text();else var t="";a.val(t).keyup()}).change()),cloudfw_jqueried("cloudfw-composer-item-title",a)||("INPUT"==n?a.bind("keyup focusout",function(){var e=jQuery(this).val();r.val(e).keyup()}):"TEXTAREA"==n&&a.bind("keyup focusout",function(){var e=jQuery(this).val();r.val(e).text(e).keyup()}))}},footer_navigation:function(){jQuery(".cloudfw-composer-copy",o).on("click",function(){var t=jQuery(this),a=t.attr("data-copy");if("selected"==a){if("object"!=typeof u)return cloudfw_dialog("Plase select a composer widget to copy","","cancel"),!1;if(u.length)var r=u}else var r=o;CloudFw_UI.modal({destroy:!0,overlay:!0,id:"cloudfw-box-composer-export",title:"Export",loader:!0,content:function(t,a,n){cloudfw_global_loading("show");var s={action:"cloudfw_copy_composer",nonce:CloudFwOp.cloudfw_nonce,post_id:jQuery("#cloudfw-composer-post-id",o).val()},i=e.serialize(r);jQuery.ajax({url:CloudFwOp.ajaxUrl,cache:!1,type:"POST",data:jQuery.param(s,!0)+"&"+i,success:function(e){try{var t=jQuery.parseJSON(e);cloudfw_dialog(t.messageTitle,t.messageText,t.messageCase);var a=' 										<div class="cloudfw-ui-modal-messages success"><div class="cloudfw-ui-modal-title">The data generated successfully.</div></div> 										<div style="margin-top: 20px;"> 											<textarea id="cloudfw-composer-export-data" style="height: 100px;">'+t.data+'</textarea> 										</div> 										<div style="margin-top: 20px; position: relative;"> 											<a id="cloudfw-composer-copy-data" href="javascript:;" class="small-button small-green"><span>Copy</span></a> 										</div> 									';
n.success(a),jQuery("#cloudfw-composer-export-data").focus().select(),jQuery("#cloudfw-composer-copy-data").zclip({path:CloudFwOp.zclipSwf,copy:function(){return""==t.data||"false"==t.data||"undefined"==t.data?"":t.data},afterCopy:function(){cloudfw_dialog("Data Copied","Export data copied to the clipboard.","ok"),n.close()}})}catch(o){cloudfw_dialog("Error","An error occurred","error"),alert(e)}cloudfw_main()}})}})}),jQuery("#cloudfw-composer-paste",o).on("click",function(){jQuery(this),CloudFw_UI.modal({destroy:!0,overlay:!0,id:"cloudfw-box-composer-import",title:"Import",loader:!0,content:function(t,a,r){var n=' 							<div style="margin-top: 20px; position: relative;"> 								Paste the exported code here: 							</div> 							<div style=""> 								<textarea id="cloudfw-composer-import-data" style="height: 100px;"></textarea> 							</div> 							<div style="margin-top: 20px; position: relative;"> 								<a id="cloudfw-composer-import" href="javascript:;" class="small-button small-green"><span>Import</span></a> 							</div> 						';r.success(n),jQuery("#cloudfw-composer-import-data",t).focus().bind("keydown keyup",function(e){13==e.which&&(a.find("#cloudfw-composer-import").click(),e.preventDefault())}),jQuery("#cloudfw-composer-import").on("click",function(){if(!t.hasClass("working")){t.addClass("working");var a={action:"cloudfw_paste_composer",nonce:CloudFwOp.cloudfw_nonce,post_id:jQuery("#cloudfw-composer-post-id",o).val(),data:jQuery("#cloudfw-composer-import-data").val()};r.loading("show"),jQuery.ajax({url:CloudFwOp.ajaxUrl,cache:!1,type:"POST",data:jQuery.param(a,!0),success:function(a){t.removeClass("working");try{var o=jQuery.parseJSON(a);cloudfw_dialog(o.messageTitle,o.messageText,o.messageCase),r.cancel()}catch(n){r.close(),d.append(a),e.seek_contents(d)}}})}})}})}),jQuery("#cloudfw-composer-delete-all",o).on("click",function(){var t=jQuery(this);if(!t.hasClass("apply"))return CloudFw_UI.sure.init({resume:function(){t.addClass("apply").click()},cancel:function(e){t.removeClass("apply"),e.close()}}),event.preventDefault(),!1;t.removeClass("apply");var a=jQuery(".composer-item",d);a.remove(),jQuery(a).removeData(),jQuery("*",a).removeData(),a.remove(),e.refresh_column_classes()}),jQuery("#cloudfw-composer-toggle-shortcuts",o).on("click",function(){var e=jQuery("#cloudfw-composer-footer"),t=(jQuery("#cloudfw-composer-footer-menu"),jQuery("#cloudfw-composer-shortcuts"));t.is(":visible")?(t.hide(),e.css("margin-top","")):(t.show(),e.css("margin-top",parseInt(t.height())))}),jQuery("#cloudfw-composer-load-prebuilt-templates",o).on("click",function(){CloudFw_UI.modal({destroy:!0,overlay:!0,id:"cloudfw-box-composer-prebuilt-templates",title:"Pre-Built Pages",loader:!0,content:function(t,a,r){var n={action:"cloudfw_get_composer_prebuilt_templates",nonce:CloudFwOp.cloudfw_nonce,post_id:jQuery("#cloudfw-composer-post-id",o).val()||""};jQuery.ajax({url:CloudFwOp.ajaxUrl,cache:!1,type:"POST",data:jQuery.param(n,!0),success:function(a){r.success(a),e.manage_templates(t,r,"import-prepage"),cloudfw_main()}})}})}),jQuery("#cloudfw-composer-save-prebuilt-template",o).on("click",function(){CloudFw_UI.modal({destroy:!0,minimize:!1,overlay:!0,id:"cloudfw-box-composer-save-template",title:"Save Template",loader:!0,content:function(t,a,o){var r={action:"cloudfw_save_composer_template_form",title:jQuery("input#title").val(),nonce:CloudFwOp.cloudfw_nonce};jQuery.ajax({url:CloudFwOp.ajaxUrl,cache:!1,type:"POST",data:jQuery.param(r,!0),success:function(r){o.success(r),jQuery("#composer_template_name",t).focus().bind("keydown keyup",function(e){13==e.which&&(a.find("#cloudfw-composer-template-save-button").click(),e.preventDefault())}),a.find("#cloudfw-composer-template-save-button").click(function(){t.hasClass("working")||(t.addClass("working"),e.save_template(t,o,"prepage"))}),cloudfw_main()}})}})}),jQuery("#cloudfw-composer-load-templates",o).on("click",function(){CloudFw_UI.modal({destroy:!0,overlay:!0,id:"cloudfw-box-composer-templates",title:"Templates",loader:!0,content:function(t,a,r){var n={action:"cloudfw_get_composer_templates",nonce:CloudFwOp.cloudfw_nonce,post_id:jQuery("#cloudfw-composer-post-id",o).val()||""};jQuery.ajax({url:CloudFwOp.ajaxUrl,cache:!1,type:"POST",data:jQuery.param(n,!0),success:function(a){r.success(a),e.manage_templates(t,r),cloudfw_main()}})}})}),jQuery("#cloudfw-composer-save-template",o).on("click",function(){CloudFw_UI.modal({destroy:!0,minimize:!1,overlay:!0,id:"cloudfw-box-composer-save-template",title:"Save as Template",loader:!0,content:function(t,a,o){var r={action:"cloudfw_save_composer_template_form",nonce:CloudFwOp.cloudfw_nonce};jQuery.ajax({url:CloudFwOp.ajaxUrl,cache:!1,type:"POST",data:jQuery.param(r,!0),success:function(r){o.success(r),jQuery("#composer_template_name",t).focus().bind("keydown keyup",function(e){13==e.which&&(a.find("#cloudfw-composer-template-save-button").click(),e.preventDefault())}),a.find("#cloudfw-composer-template-save-button").click(function(){t.hasClass("working")||(t.addClass("working"),e.save_template(t,o))}),cloudfw_main()}})}})})},manage_templates:function(t,a,r){var n=jQuery("#cloudfw-composer-templates");n.find(".use").click(function(){var t=jQuery(this),n=t.attr("rel");r||(r="import");var s={action:"cloudfw_composer_template_actions",type:r,nonce:CloudFwOp.cloudfw_nonce,post_id:jQuery("#cloudfw-composer-post-id",o).val()||"",template_id:n||""};a.loading("show"),jQuery.ajax({url:CloudFwOp.ajaxUrl,cache:!1,type:"POST",data:jQuery.param(s,!0),success:function(t){try{var o=jQuery.parseJSON(t);cloudfw_dialog(o.messageTitle,o.messageText,o.messageCase),a.close()}catch(n){a.close(),"import-prepage"==r?d.html(t):d.append(t),e.seek_contents(d)}cloudfw_main()}})}),n.find(".remove").click(function(){var e=jQuery(this),t=e.attr("rel"),r={action:"cloudfw_composer_template_actions",type:"delete",nonce:CloudFwOp.cloudfw_nonce,post_id:jQuery("#cloudfw-composer-post-id",o).val()||"",template_id:t||""};jQuery.ajax({url:CloudFwOp.ajaxUrl,cache:!1,type:"POST",data:jQuery.param(r,!0),success:function(t){try{var o=jQuery.parseJSON(t);cloudfw_dialog(o.messageTitle,o.messageText,o.messageCase),e.parents("li").first().fadeOut(function(){jQuery(this).remove()}),a.cancel()}catch(r){cloudfw_dialog("We couldn't delete it :(","An error occurred when deleting the template","error"),alert(t)}cloudfw_main()}})})},save_template:function(e,t,a){var r={action:"cloudfw_save_composer_template",nonce:CloudFwOp.cloudfw_nonce,post_id:jQuery("#cloudfw-composer-post-id",o).val()||"",template_name:jQuery("#composer_template_name",e).val()||"",type:a};t.loading("show"),jQuery.ajax({url:CloudFwOp.ajaxUrl,cache:!1,type:"POST",data:jQuery.param(r,!0),success:function(a){e.removeClass("working");try{var o=jQuery.parseJSON(a);"update"==o.messageCase?t.close():t.cancel(),cloudfw_dialog(o.messageTitle,o.messageText,o.messageCase)}catch(r){cloudfw_dialog("We couldn't save :(","An error occurred when saving","error"),alert(a)}}})},shortcuts:function(){shortcut.add("Ctrl+S",function(){h.click()},{type:"keydown",propagate:!1,target:document}),shortcut.add("Ctrl+E",e.done_editing,{type:"keydown",propagate:!1,target:document}),shortcut.add("Ctrl+D",function(){return d.hasClass("edit-mode")?!0:void("object"==typeof u&&u.length&&u.find(".composer-item-controls").first().find(".item-duplicate").click())},{type:"keydown",propagate:!1,target:document,disable_in_input:!1}),shortcut.add("DELETE",function(){return d.hasClass("edit-mode")?!0:void("object"==typeof u&&u.length&&u.find(".composer-item-controls").first().find(".item-remove").click())},{type:"keydown",propagate:!0,target:document,disable_in_input:!0}),shortcut.add("F2",function(){"object"==typeof u&&u.length&&u.find(".composer-item-controls").first().find(".title-text").click()},{type:"keydown",propagate:!0,target:document,disable_in_input:!1}),shortcut.add("Ctrl+Up",function(){e.move_up()},{type:"keydown",propagate:!1,target:document,disable_in_input:!0}),shortcut.add("Ctrl+Down",function(){e.move_down()},{type:"keydown",propagate:!1,target:document,disable_in_input:!0}),shortcut.add("CTRL+Left",function(){"object"==typeof u&&u.length&&u.find(".composer-item-controls").first().find(".column-decrease").click()},{type:"keydown",propagate:!0,target:document,disable_in_input:!0}),shortcut.add("CTRL+Right",function(){"object"==typeof u&&u.length&&u.find(".composer-item-controls").first().find(".column-increase").click()},{type:"keydown",propagate:!0,target:document,disable_in_input:!0}),shortcut.add("Tab",e.select_down,{type:"keydown",propagate:!1,target:document,disable_in_input:!0}),shortcut.add("shift+Tab",e.select_up,{type:"keydown",propagate:!1,target:document,disable_in_input:!0}),shortcut.add("CTRL+SHIFT+C",function(){jQuery(".cloudfw-composer-copy[data-copy=selected]:first").click()},{type:"keydown",propagate:!1,target:document,disable_in_input:!0}),shortcut.add("CTRL+SHIFT+V",function(){jQuery("#cloudfw-composer-paste").click()},{type:"keydown",propagate:!1,target:document,disable_in_input:!0})},title:function(e,t){if("number"!=typeof t)var t=25;var a=e.length;return t>=a?e:e.substr(0,t)+".."},focusout:function(){jQuery("body").find(":focus").focusout(),jQuery('<input type="text" />').appendTo(jQuery("body")).focus().focusout().remove()}};jQuery(document).ready(function(){t.init()})}(jQuery);